SecRule REQUEST_URI "@rx ^.*/([^/]+)$" \
    "id:100127,phase:2,log,auditlog,pass,capture,\
    setvar:'tx.raw_urlpath_value=%{TX.1}',\
    msg:'Captured URL path value: %{TX.raw_urlpath_value}'"

SecRule TX:raw_urlpath_value "@rx .+" \
    "id:100128,phase:2,log,auditlog,pass,t:base64Decode,t:htmlEntityDecode,capture,\
    setvar:'tx.base64_decoded_value=%{MATCHED_VAR}',\
    msg:'Base64-decoded value: %{TX.base64_decoded_value}'"

SecRule TX:raw_urlpath_value|TX:base64_decoded_value "@rx (?i)\bexec=`[^`]+`|--remote=origin" \
    "id:100129,phase:2,log,auditlog,block,\
    msg:'Detected XSS in URL path payload',severity:CRITICAL,\
    tag:'paranoia-level/4',\
    setvar:'tx.xss_score=+%{tx.critical_anomaly_score}',\
    setvar:'tx.inbound_anomaly_score_pl4=+%{tx.critical_anomaly_score}'"
